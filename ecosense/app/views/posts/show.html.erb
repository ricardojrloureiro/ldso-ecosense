<% provide(:title, @post.title) %>

<div class="widewrapper main">
  <div class="container">
    <div class="row">
      <div class="col-md-12">

        <article class="blog-post">

        <header>
            <h1><%= @post.title %></h1>
            <div class="lead-image">            
              <div class="meta clearfix">
                  <div class="author" style="float:left;">
                      <i class="fa fa-user"></i>
                      <span class="data"><%= @post.user.name %></span>
                  </div>
                  <div class="date" style="float:left; margin-left: 10px;">
                      <i class="fa fa-calendar"></i>
                      <span class="data"><%= time_ago_in_words(@post.created_at) %> ago</span>
                  </div>
                  <div class="comments" style="float:left; margin-left: 10px;">
                      <i class="fa fa-comments"></i>
                      <span class="data"><a href="blog-detail.html#comments">26 Comments</a></span>
                  </div>                                
              </div>
          </div>
          </header>

          <div class="body" style="padding: 20px 0 20px 0;">
            <%= @post.content %>
          </div>

          <button id="like" data-url="<%= like_path(@post.id) %>" class="btn btn-primary btn-lg">
              <i class="fa fa-thumbs-up"></i>
              <%= pluralize(@likes.count, 'like') %>
          </button>
          </article>

          <aside class="comments" id="comments">
            <hr>
            <h2><i class="fa fa-comments"></i> <%= @comments.count %> comments </h2>

            <% @comments.each do |comment| %>
                <article class="comment">
                  <header class="clearfix">
                    <img src="<%= comment.user.avatar.url(:medium) %>" alt="User avatar" class="avatar">
                    <div class="meta">
                      <h3><a href="<%= user_path(comment.user) %>"><%= comment.user.name %></a></h3>
                      <span class="date">
                          <%= time_ago_in_words(comment.created_at) %> ago
                      </span>

                    </div>
                  </header>
                  <div class="body">
                    <%= comment.content %>
                  </div>
                </article>
            <% end %>
          </aside>

        <% if logged_in? %>
          <aside class="create-comment" id="create-comment">
            <hr>

            <h2><i class="fa fa-heart"></i> Add Comment</h2>

            <textarea rows="10" name="message" id="comment-body" placeholder="Your thoughts..." class="form-control input-lg"></textarea>

            <div class="buttons clearfix">
              <button id="clear-comment"  class="btn btn-xlarge btn-tales-two">Cancel</button>
              <button id="comment" data-url="<%= comment_path(@post.id)%>" class="btn btn-xlarge btn-tales-one">Submit</button>
            </div>

          </aside>
        <% end %>
        </div>
      </div>
    </div>
</div>

<script>
  $("#like").click(function(){
    var button = $(this);
    $.ajax({
      type: "POST",
      url: $(this).data("url"),
      success: function(data){
        button.html('<i class="fa fa-thumbs-up"></i> ' + data.likes);
      }
    });
  });

  $("#clear-comment").click(function(){
    $("#comment-body").val('');
  });

  $("#comment").click(function(){
    var button = $(this);
    $.ajax({
      type: "POST",
      url: $(this).data("url"),
      data: {content: $("#comment-body").val()},
      success: function(data){
        $("#comment-body").val('');
        var comment = data.commentAdded;
        commentHtml = '<article class="comment"><header class="clearfix"><img src="' + data.userAvatar + '" alt="User avatar" class="avatar"><div class="meta"><h3><a href="'+ data.userPath +'">'+ data.userName +'</a></h3><span class="date">'+ "just now" + '</span></div></header><div class="body">'+comment.content+'</div></article>'
        $("#comments").append(commentHtml);
      }
    });
  });
</script>